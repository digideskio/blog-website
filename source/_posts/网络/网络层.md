category: 计算机基础
date: 2015-11-08
title: 网络层
---
##  网络层
网络层通过地址将数据从众多链路中传送到最终地址上.它实现的是终端节点之间的通信. 相比于数据链路层的只能在同一种数据链路中进行数据传输,网络层可以跨数据链路进行数据传输(这一点是通过下面介绍的路由器实现的).说的更加通俗一点是:数据链路层只是负责俩个设备之间的通信,但是如果想要跨多个设备通信的话,就只能借助网络层了.

> 至于为什么需要网络层呢?是这样的,数据链路只能在同一种介质中进行通信,如果无线想要和以太网进行数据传输的话,单靠数据链路层是没办法完成这个需求的,此时就需要借助网络层的路由器了.

网络层相关协议:
* ARP
* IP
* ICMP

网络层接受到传输层发送过来的数据(如:TCP首部+应用层数据),如果由UP模块处理,IP模块就会在数据首部再添加IP首部:
* 接收端IP
* 发送端IP
* 判断传输层数据是TCP还是UDP数据的信息
 
当IP包生成之后,会根据接收端IP从路由表里边查找接受该数据包的路由或者主机. 然后IP包会被发送给连接路由器或者NIC的驱动程序,实现真正的数据传输.

### 路由器
路由器在网络层上连接网络,并对分组报文进行转发. 路由器使用IP地址进行进行处理. 路由器可以连接不同的数据链路,例如连接以太网和一个FDDI.

### ARP
当我们在写网络程序的时候,无论是HTTP协议还是TCP协议,我们只需要知道对方的IP地址就可以向其发送消息,但是在数据链路层在实际通信时,必须知道对方的MAC地址.

我们就是通过ARP协议来通过IP地址找到对方的MAC地址的. 当主机A要向主机B发送一个消息时,主机A会尝试从自己的ARP表中查找目标IP的MAC地址. 如果找到了目标MAC地址,就直接向该MAC地址发送消息. 如果找不到MAC地址,主机A就向链路中发送ARP请求,链路中的所有主机和路由器都会对其进行解析. 当主机B与主机A在同一链路中,此时主机B会发送主机A发出的ARP请求与自己的IP地址一致,主机B就会回应一个ARP响应,响应中包含着主机B的MAC地址. 主机A接收到主机B的ARP响应后,会将主机B的MAC地址和IP地址的对应关系,缓存到自己的ARP表中.
> ARP是为了提高性能而设计的. 如果每次IP通信都需要进行一次ARP请求,会造成非常大的网络流量

上面我们只是阐述了,在同一链路中找到了目标主机,但是如果找不到呢?

> 其实还有一种RARP协议,这个协议是将MAC地址定位IP地址的协议,与ARP协议恰恰相反. 平常我们在电脑里设置IP地址时,可以通过设置为自动获取IP地址(通过DHCP实现),但是使用嵌入式设备,我们可能就没有办法通过DHCP来获取IP地址了,那么,我们就需要架设一台RARP服务器,从而在这个设备上注册设备的MAC地址及其IP地址.


