
# AWK
awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。

语法
```
awk [-F  field-separator]  'commands'  input-file(s)
```
* -F: 域分隔符,由域分隔符分开的每一项称为一个域。通常，在不指名-F域分隔符的情况下，默认的域分隔符是空格。(我们指定:为分隔符`-F ':'`)
* commands: 'PATTERN{COMMAND}'. PATTERN为模式(正在表达式),COMMAND为要执行的命令.

```
awk  -F ':'  'BEGIN {print "start"}  {print $1"} END {print "end"}' ./txt
```
上面的例子是读取`txt`文件,然后使用`:`分割每一行数据,在开始处理的时候输出start，在处理过程中第一列数据，最后输出end。

## 变量

### 内置变量
我们可以在AWK命令中直接使用以下内置变量
```
ARGC               命令行参数个数
ARGV               命令行参数排列
ENVIRON            支持队列中系统环境变量的使用
FILENAME           awk浏览的文件名
FNR                浏览文件的记录数
FS                 设置输入域分隔符，等价于命令行 -F选项
NF                 浏览记录的域的个数
NR                 已读的记录数
OFS                输出域分隔符
ORS                输出记录分隔符
RS                 控制记录分隔符
```
例如
```
jps -l | awk '{print ARGC}'
```

### 自定义变量
我们通过赋值的方式直接定义一个变量
```
jps -l | awk 'BEGIN{size=0;} {size=1+size} {print $1} END{print size}'
```
上面我们定义了一个数值型的size变量.

### 数组


# 流程控制
## 条件语句
下面输出了大于10000的java进程号
```
jps -l | awk 'BEGIN{size=0} {if($1>10000) {size++;print $1}} END{print size}'
```

## 循环语句
awk中的循环语句借鉴于C语言，支持while、do/while、for、break、continue，这些关键字的语义和C语言中的语义完全相同。

# 字符串处理
## sub函数
匹配从左侧开始找到的第一个符合规则的字符串，然后使用替换字符串替换这些字符串
```
jps -l | awk '{sub(/moon/, "sun")} {print $2}'
```
上面这个例子就使用sun这个字符串替换了$2中的moon字符串。

我们还可以指定在哪列执行查找替换
```
jps -l | awk '{sub(/moon/, "sun", $1)} {print $2}'
```
上面的例子中我们只在第一列进行查找替换

## gsub函数
与sub函数不同的是，这个执行的是全局替换
```
jps -l | awk '{gsub(/moon/, "sun")} {print $2}'
```

## index函数
返回子字符串第一次被匹配的位置，偏移量从位置1开始
```
jps -l | awk '{print$2; $2=index($2, "moon")} {print $2}'
```

## length函数
返回记录的字符数
```
jps -l | awk '{print$2; $2=length($2)} {print $2}'
```

## substr函数
返回从位置1开始的子字符串，如果指定长度超过实际长度，就返回整个字符串
```
jps -l | awk '{print substr($2, 2, 10)} '
```
上面的例子将$2字符串从第二个字符还是截取，截取10个长度的字符串出来

## match函数
```

```

## toupper和tolower函数
可用于字符串大小间的转换
```
awk '{print toupper($2)} '
```

## split函数
可按给定的分隔符把字符串分割为一个数组
```
jps -l | awk '{ split($2, array, "/"); print array[3]} '
```
上面的例子我们将$2这一列按照`/`进行分割,然后将分割出的数据存储到array数组里. 注意这里首先不需要转义
