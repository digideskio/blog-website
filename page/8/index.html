
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>ming15</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ming15">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="ming15">
<meta property="og:url" content="http://www.ming15.wang/page/8/index.html">
<meta property="og:site_name" content="ming15">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ming15">
<meta name="twitter:description">

    
    <link rel="alternative" href="/atom.xml" title="ming15" type="application/atom+xml">
    
    
    
    <link rel="apple-touch-icon" href="/img/author.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/author.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="ming15" title="ming15"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="ming15">ming15</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
						<form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 17728547076946147000 ><input type="text" name="q" size="30" placeholder="Search"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/11/08/网络/数据链路层/" title="数据链路层" itemprop="url">数据链路层</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-11-07T16:00:00.000Z" itemprop="datePublished"> Published 2015-11-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>物理层负责将实际设备过程中的电压的高低,光的闪灭,电波的强弱新号等与二进制0,1进行转换. 而数据链路层则负责将0,1数据集合成帧块后进行传输.</p>
<ul>
<li>数据链路段： 数据链路段是指一个被分割的网络.</li>
</ul>
<p>网络拓扑： 网络的连接与构成的形态被称为网络拓扑，有以下分类</p>
<ul>
<li><a href="">总线型</a></li>
<li><a href="">环形</a></li>
<li><a href="">星形</a></li>
<li><a href="">混合型</a></li>
</ul>
<h3 id="MAC地址"><a href="#MAC地址" class="headerlink" title="MAC地址"></a>MAC地址</h3><p>MAC地址用于识别数据链路中的互联的节点. 不论哪种数据链路的网络(以太网,FDDI,ATM,无线LAN),他们彼此的MAC地址都是唯一的.MAC地址总长46位,一般用16进制表示.</p>
<ul>
<li>第一位:单播地址(0)/多播地址(1)</li>
<li>第2位: 全局地址(0)/本地地址(1)</li>
<li>第3-24位:由IEEE管理并保证各厂家不重复</li>
<li>第25-48位:由厂商管理并保证产品之间不重复</li>
</ul>
<h3 id="通信介质"><a href="#通信介质" class="headerlink" title="通信介质"></a>通信介质</h3><p>从通信介质的使用方法来看,网络可以分为共享型介质和非共享型介质:</p>
<p>共享介质型网络：是指多个设备共享一个通信介质的网络.在这种方式下多个设备使用同一个载波信道进行发送和接受,基本上采用半双工通信.</p>
<ul>
<li>半双工: 在数据链路上同时只发送或者只接受的通信方式</li>
<li>全双工: 在数据链路上同时即可以发送也可以接受数据的通信方式</li>
</ul>
<p>共享介质型网络有俩种访问控制方式:</p>
<ul>
<li>争用方式:</li>
<li>令牌传递方式:</li>
</ul>
<p>非共享介质:</p>
<h3 id="分组交换"><a href="#分组交换" class="headerlink" title="分组交换"></a>分组交换</h3><p>目前网络通信方式大致分为俩种：</p>
<ul>
<li>电路交换：这种交换技术主要应用于过去的电话网. 在这种交换中,交换机主要负责数据的中转处理. 计算机之间的连接是通过交换机连接上的,当俩个计算机通信之后,他们俩者就一直占用着这条线路</li>
<li>分组交换：由于电路交换, 俩台计算机会一直占用某条线路,当有新的计算机连接到这条线路上想要通信时,就只能等当前通信的计算机断开连接,于是噩梦就这样产生了.</li>
</ul>
<p>在这种情况下,人们提出了分组交换. 即将数据进行分组成多个数据包,每个分组首部已经写入了发送端和接收端地址,然后当分组交换机(路由器)接收到分组数据之后,会将其缓存到自己的缓冲区中,然后再按照先进先出的规则将数据转发出去. 这样在同一条线路上也可以为多个计算机服务.</p>
<p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/net/%E5%88%86%E7%BB%84%E4%BA%A4%E6%8D%A2.jpg" alt="分组交换"></p>
<h3 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h3><h3 id="网桥"><a href="#网桥" class="headerlink" title="网桥"></a>网桥</h3><p>网桥交换机在数据链路层上连接俩个网络设备. 它使用物理地址(MAC地址)进行处理.</p>
<p>网桥能够识别数据链路中的数据帧,并将其缓存起来重新生成新的数据帧发送给另一个网段. 得益于网桥的缓存功能,使得网桥能够连接传输速率完全不同的数据链路,并且不限制连接网段的个数.</p>
<h2 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h2><h3 id="中继器"><a href="#中继器" class="headerlink" title="中继器"></a>中继器</h3><p>由电缆传过来的电信号或者光信号经由中继器的波形调整和放大再传给另一个电缆</p>
<p>一般中继器俩段连接的是相同的媒介,但有的中继器也可以连接不同的媒介. 例如同轴电缆与光缆之间的信号调整,但是即使在这种情况下,TA也只是单纯的负责信号在0和1比特流之间的替换,并不判断数据是否有错误. 同时它只负责将电信号转换为光信号,因此不能在不同的媒介之间进行转发.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/TCP-IP/">TCP IP</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/11/08/网络/数据链路层/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/11/08/网络/数据链路层/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/11/02/网络/OSI参考模型/" title="OSI参考模型" itemprop="url">OSI参考模型</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-11-01T16:00:00.000Z" itemprop="datePublished"> Published 2015-11-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>OSI参考模型:</p>
<ul>
<li>应用层: 为应用程序提供服务,并规定应用程序中通信相关的细节.</li>
<li>表示层: 将应用处理的信息转换为适合网络传输的格式或者将下一层的数据转换为上层能够处理的格式</li>
<li>会话层: 负责建立和断开通信连接,以及数据的分割等数据传输相关的管理</li>
<li>传输层: 管理俩个节点的数据传输</li>
<li>网络层: 负责寻址和路由选择.</li>
<li>数据链路层: 负责物理层面上互联的,节点之间的通信传输.</li>
<li>物理层: 负责0,1比特流与电压的高低,光的闪灭之间的互换</li>
</ul>
<blockquote>
<p>表示层: 表示层担当着”统一的网络数据格式”与应用特定数据格式转换的功能. 实际上也就是将应用层的数据按照指定的格式进行编码,然后在数据首部添加首部信息.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/TCP-IP/">TCP IP</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/11/02/网络/OSI参考模型/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/11/02/网络/OSI参考模型/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/26/操作系统/NUMA/" title="NUMA和RDMA" itemprop="url">NUMA和RDMA</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-10-25T16:00:00.000Z" itemprop="datePublished"> Published 2015-10-26</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="支持NUMA的CPU"><a href="#支持NUMA的CPU" class="headerlink" title="支持NUMA的CPU"></a>支持NUMA的CPU</h2><p>英特尔系列的</p>
<ul>
<li>Nehalem和Tukwila系列之后的处理器</li>
<li>Xeon</li>
<li>至强处理器 E5-2690</li>
<li>i3、i5、i7</li>
</ul>
<p>HP系列的</p>
<ul>
<li>Superdome</li>
<li>SGI的Altix 3000</li>
</ul>
<p>IBM的</p>
<ul>
<li>p690</li>
<li>x440</li>
</ul>
<p>NEC</p>
<ul>
<li>TX7</li>
</ul>
<p>AMD</p>
<ul>
<li>Opteron</li>
</ul>
<h2 id="Linux中关于NUMA的命令"><a href="#Linux中关于NUMA的命令" class="headerlink" title="Linux中关于NUMA的命令"></a>Linux中关于NUMA的命令</h2><ul>
<li>NUMACTL ：设定进程NUMA策略的命令行工具。</li>
<li>NUMASTAT ：获取NUMA内存访问统计信息的命令行工具</li>
</ul>
<p>开启NUMA<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numactl --cpunodebind=<span class="number">0</span> --membind=<span class="number">0</span> myapp</span><br></pre></td></tr></table></figure></p>
<h1 id="JAVA中的NUMA"><a href="#JAVA中的NUMA" class="headerlink" title="JAVA中的NUMA"></a>JAVA中的NUMA</h1><p><code>-XX:+UseNUMA</code>启用Numa, 默认情况下,JVM所占内存会随机的分配到不同的NUMA节点上,当cpu运算时可能会到不同的NUMA节点的告诉缓存上进行数据查找,降低系统速度,可使用numactl工具将JVM进程绑定到特定的NUMA节点上,只让其访问自己所在节点的内存.</p>
<h1 id="NUMA用于MySQL"><a href="#NUMA用于MySQL" class="headerlink" title="NUMA用于MySQL"></a>NUMA用于MySQL</h1><p>调优的时候，有哪些关键配置项，需要注意什么</p>
<ul>
<li><code>numactl --interleave=all</code></li>
<li>在MySQL进程启动前，使用<code>sysctl -q -w vm.drop_caches=3</code>清空文件缓存所占用的空间</li>
<li>Innodb在启动时，就完成整个<code>Innodb_buffer_pool_size</code>的内存分配</li>
</ul>
<h1 id="RDMA"><a href="#RDMA" class="headerlink" title="RDMA"></a>RDMA</h1><p>RDMA 技术需要怎样的硬件，寻找一篇RDMA用于数据库或者Java的文章，对其性能和用法做简单的阐述。</p>
<p>RDMA是一种网卡技术,采用该技术可以使一台计算机直接将信息放入另一台计算机的内存中。RDMA通过在网卡上将可靠传输协议固化于硬件,以及支持绕过内核的零拷贝网络这两种途径来达到这一目标。绕过内核使应用程序不必执行内核调用就可以向网卡发出命令。当一个应用程序执行RDMA读/写请求时,系统并不执行数据拷贝动作。这就减少了处理 网络通信时在内核空间和用户空间上下文切换的次数。RDMA请求的完成,或者完全在用户空间中进行,或者在应用程序希望进入睡眠直到完成信号出现的情况下 通过内核进行。</p>
<p>RDMA实现：</p>
<ul>
<li>利用传统的网络硬件,以TCP/IP及以太网络标准来建立因特网</li>
<li>InfiniBand网络和实现虚拟接口架构的网络支持RDMA.</li>
</ul>
<p>采用RDMA来获取高性能的协议包括</p>
<ul>
<li>Sockets Direct Protocol</li>
<li>SCSI RDMA Protocol（SRP）</li>
<li>Direct Access File System（DAFS）</li>
</ul>
<h2 id="Java-7-SDP"><a href="#Java-7-SDP" class="headerlink" title="Java 7 SDP"></a>Java 7 SDP</h2><p>在Solaris系统上只要有物理InfiniBand网卡，Java 7 SDP就可以立即工作。</p>
<p>Linux则通过Open Fabrics Enterprise Distribution（OFED）包支持SDP。</p>
<blockquote>
<p>确认Linux版本有没有配置OFED设备驱动器，<code>egrep &quot;^[ \t]+ib&quot; /proc/net/dev</code>可以使用该命令测试.</p>
</blockquote>
<p>Java只通过<code>java.net.Socket、java.net.ServerSocket、java.net.Datagram</code>对传输层进行抽象,通过<code>Java.net.InetAddress</code>对网络层进行抽象.只需要将JVM和InfiniBand操作系统设备和库进行设定,java就可以通过传输层抽象直接与物理层进行访问,从而绕过了网络层和数据链路层.</p>
<p>SDP也能让Java具备非常强大的“零拷贝”,这个零拷贝并不是指的是<code>java.nio.channels.FileChannel</code>的<code>transferTo()</code>实现的零拷贝.而是直接使用原生的InfiniBand零拷贝协议实现。现在CPU不用将一个内存区域的数据拷贝到另一个内存区域。CPU可以继续处理其他任务，数据拷贝则由机器的另一部分并行处理，这样就提升了性能。此外，零拷贝操作减少了在用户空间和内核空间之间切换所消耗的时间。</p>
<p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/net/javasdp.jpg" alt=""></p>
<h3 id="配置JVM7支持SDP"><a href="#配置JVM7支持SDP" class="headerlink" title="配置JVM7支持SDP"></a>配置JVM7支持SDP</h3><p>SDP配置文件是个文本文件，JVM启动时会从本地文件系统读取该文件。我们有俩种规则来定义：</p>
<ol>
<li>bind规则：只要TCP套接字绑定到与规则匹配的地址和端口，就会使用SDP协议进行传输。</li>
<li>connect规则：没有绑定的TCP套接字尝试连接匹配规则的地址和端口时，就会使用SDP协议进行传输。<br>第一个关键字用来表明规则是bind还是connect。第二部分指定主机名或IP地址。当指定为IP地址时，你也可以指定表示IP地址范围的前缀。第三部分即最后一个部分是端口号或端口号范围。<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 绑定到192.168.1.196主机所有端口使用SDP</span><br><span class="line">bind 192.168.1.196 *</span><br><span class="line"></span><br><span class="line"># 连接到192.168.2.*上的所有应用服务时都使用SDP</span><br><span class="line">connect 192.168.2.0/24 1024-*</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="使用SDP的JVM7"><a href="#使用SDP的JVM7" class="headerlink" title="使用SDP的JVM7"></a>使用SDP的JVM7</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java \</span><br><span class="line">-Dcom.sun.sdp.conf=sdp.conf \</span><br><span class="line">-Djava.net.preferIPv4Stack=<span class="keyword">true</span> \</span><br><span class="line">Application.class</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意要指定网络格式为<code>IPv4Stack</code>。尽管Java 7和InfiniBand都支持IPv6网络格式，但Solaris和Linux都不支持两者之间的映射。所以启动支持SDP的Java 7 VM时，还是要使用基础、可靠的IPv4网络格式。</p>
</blockquote>
<h2 id="IO性能度量"><a href="#IO性能度量" class="headerlink" title="IO性能度量"></a>IO性能度量</h2><h3 id="全SSD硬盘的IO阀值"><a href="#全SSD硬盘的IO阀值" class="headerlink" title="全SSD硬盘的IO阀值"></a>全SSD硬盘的IO阀值</h3><p>SSD 硬盘传输速率取 500M/S<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.1</span>ms + <span class="number">0</span> + <span class="number">4</span>K/<span class="number">500</span>MB = <span class="number">0.1</span> + <span class="number">0</span> + <span class="number">0.008</span> = <span class="number">0.108</span></span><br><span class="line"></span><br><span class="line">IOPS = <span class="number">1</span>/<span class="number">0.108</span> ms = <span class="number">9259</span> IOPS</span><br></pre></td></tr></table></figure></p>
<p>吞吐率 = <code>9259 * 4K = 37M / 500M = 7.4%</code></p>
<h3 id="1万转机械磁盘的IO阀值"><a href="#1万转机械磁盘的IO阀值" class="headerlink" title="1万转机械磁盘的IO阀值"></a>1万转机械磁盘的IO阀值</h3><p>1 万转机械磁盘传输速率取 200M/S<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span>ms + (<span class="number">60</span>sec/<span class="number">10000</span>RPM/<span class="number">2</span>) + <span class="number">4</span>K/<span class="number">200</span>MB = <span class="number">5</span> + <span class="number">3</span> + <span class="number">0.02</span> = <span class="number">8.02</span> IOPS = <span class="number">1</span>/<span class="number">8.02</span>s ms = <span class="number">125</span> IOPS</span><br></pre></td></tr></table></figure></p>
<p>吞吐率 = <code>125 * 4K = 500K / 200M = 0.25%</code></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/操作系统/">操作系统</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/26/操作系统/NUMA/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/26/操作系统/NUMA/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/linux/Linux系统命令/" title="Linux系统命令" itemprop="url">Linux系统命令</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-10-14T16:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Vmstat"><a href="#Vmstat" class="headerlink" title="Vmstat"></a>Vmstat</h3><p>vmstat是Virtual Meomory Statistics（虚拟内存统计）的缩写, 是实时系统监控工具。</p>
<p>一般vmstat工具的使用是通过两个数字参数来完成的，第一个参数是采样的时间间隔数，单位是秒，第二个参数是采样的次数，如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@cvs /]# vmstat 2 1</span><br><span class="line">=&gt;</span><br><span class="line">procs  -----------memory----------     ---swap--  -----io----  --system--   -----cpu-----</span><br><span class="line"> r  b    swpd   free   buff  cache      si   so     bi    bo    in   cs     us sy id wa st</span><br><span class="line"> 1  0  1339624 525012 464316 6796908    0    0      5    32     0    0      2  0 98  0  0</span><br></pre></td></tr></table></figure></p>
<p>参数</p>
<ul>
<li>-a：显示活跃和非活跃内存</li>
<li>-f：显示从系统启动至今的fork数量 。</li>
<li>-m：显示slabinfo</li>
<li>-n：只在开始时显示一次各字段名称。</li>
<li>-s：显示内存相关统计信息及多种系统活动数量。</li>
<li>delay：刷新时间间隔。如果不指定，只显示一条结果。</li>
<li>count：刷新次数。如果不指定刷新次数，但指定了刷新时间间隔，这时刷新次数为无穷。</li>
<li>-d：显示磁盘相关统计信息。</li>
<li>-p：显示指定磁盘分区统计信息</li>
<li>-S：使用指定单位显示。参数有 k 、K 、m 、M ，分别代表1000、1024、1000000、1048576字节（byte）。默认单位为K（1024 bytes）</li>
<li>-V：显示vmstat版本信息。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/other/%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81.gif" alt=""><br>我们从上面那个图来解释各个参数</p>
<blockquote>
<p>porcs</p>
<ul>
<li>r：表示运行队列(分配到CPU进程数)</li>
<li>b：阻塞状态的进程数</li>
</ul>
<p>memory</p>
<ul>
<li>swpd：虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了</li>
<li>free：空闲的物理内存的大小</li>
<li>buff：作为buffer使用的内存数量（Linux/Unix系统是用来存储，目录里面有什么内容，权限等的缓存）</li>
<li>cache：作为缓存使用的内存数量（ cache直接用来记忆我们打开的文件,给文件做缓冲）</li>
<li>inact：非活跃内存数</li>
<li>active： 活跃内存数</li>
</ul>
<p>swap</p>
<ul>
<li>si：从磁盘交换的内存量（每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了）</li>
<li>so：向磁盘交换的内存量（每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上）</li>
</ul>
<p>io</p>
<ul>
<li>bi：从阻塞设备接受到的块数据数量。</li>
<li>bo：向阻塞设备发送的块数据数量。</li>
</ul>
<p>system</p>
<ul>
<li>in：每秒CPU的中断次数，包括时间中断</li>
<li>cs：每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目</li>
</ul>
<p>cpu</p>
<ul>
<li>us：用户CPU时间</li>
<li>sy：系统CPU时间</li>
<li>id：空闲 CPU时间</li>
<li>wa：等待IO CPU时间</li>
<li>st</li>
</ul>
</blockquote>
<h3 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h3><p>监控锁竞争<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@cvs /]# pidstat</span><br><span class="line">Linux 2.6.32-279.el6.x86_64 (cvs)       2015年10月15日  _x86_64_        (8 CPU)</span><br><span class="line"></span><br><span class="line">PID    %usr %system  %guest    %CPU   CPU  Command</span><br></pre></td></tr></table></figure></p>
<p>显式参数</p>
<ul>
<li>PID : 被监控的任务的进程号</li>
<li>%usr :  当在用户层执行(应用程序)时这个任务的cpu使用率，和 nice 优先级无关。注意这个字段计算的cpu时间不包括在虚拟处理器中花去的时间。</li>
<li>%system :  这个任务在系统层使用时的cpu使用率。</li>
<li>%guest ：  任务花费在虚拟机上的cpu使用率（运行在虚拟处理器）。</li>
<li>%CPU ：  任务总的cpu使用率。在SMP环境(多处理器)中，如果在命令行中输入-I参数的话，cpu使用率会除以你的cpu数量。</li>
<li>CPU ： 正在运行这个任务的处理器编号。</li>
<li>Command ： 这个任务的命令名称。</li>
</ul>
<p>参数</p>
<ul>
<li>-u: pidstat将显示各活动进程的cpu使用统计</li>
<li>-p: 我们可以查看特定进程的系统资源使用情况：</li>
<li>-r: pidstat将显示各活动进程的内存使用统计：</li>
<li>-d: 我们可以查看进程IO的统计信息</li>
</ul>
<p>-d:</p>
<ul>
<li>kB_rd/s: 每秒进程从磁盘读取的数据量(以kB为单位)</li>
<li>kB_wr/s: 每秒进程向磁盘写的数据量(以kB为单位)</li>
<li>Command: 拉起进程对应的命令</li>
</ul>
<p>-r:</p>
<ul>
<li>minflt/s: 每秒次缺页错误次数(minor page faults)，次缺页错误次数意即虚拟内存地址映射成物理内存地址产生的page fault次数</li>
<li>majflt/s: 每秒主缺页错误次数(major page faults)，当虚拟内存地址映射成物理内存地址时，相应的page在swap中，这样的page fault为major page fault，一般在内存使用紧张时产生</li>
<li>VSZ:      该进程使用的虚拟内存(以kB为单位)</li>
<li>RSS:      该进程使用的物理内存(以kB为单位)</li>
<li>%MEM:     该进程使用内存的百分比</li>
<li>Command:  拉起进程对应的命令</li>
</ul>
<h3 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h3><p>iostat用于输出CPU和磁盘I/O相关的统计信息.</p>
<ul>
<li><code>-c</code> 仅显示CPU统计信息.与-d选项互斥.</li>
<li><code>-d</code> 仅显示磁盘统计信息.与-c选项互斥.</li>
<li><code>-k</code> 以K为单位显示每秒的磁盘请求数,默认单位块.</li>
<li><code>-p device | ALL</code>  与-x选项互斥,用于显示块设备及系统分区的统计信息.也可以在-p后指定一个设备名,如:<code>iostat -p hda</code> 或显示所有设备<code>iostat -p ALL</code></li>
<li><code>-t</code>    在输出数据时,打印搜集数据的时间.</li>
<li><code>-V</code>    打印版本号和帮助信息.</li>
<li><code>-x</code>    输出扩展信息.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@cvs /]# iostat</span><br><span class="line">Linux 2.6.32-279.el6.x86_64 (cvs)       2015年10月16日  _x86_64_        (8 CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           1.67    0.00    0.21    0.38    0.00   97.74</span><br><span class="line"></span><br><span class="line">Device:            tps   Blk_read/s   Blk_wrtn/s   Blk_read   Blk_wrtn</span><br><span class="line">sda              18.64        72.79       512.65  951732770 6702726216</span><br></pre></td></tr></table></figure>
<p>avg-cpu:  </p>
<ul>
<li><code>%user</code>: 在用户级别运行所使用的CPU的百分比.</li>
<li><code>%nice</code>: nice操作所使用的CPU的百分比.</li>
<li><code>%system</code>: 在系统级别(kernel)运行所使用CPU的百分比.</li>
<li><code>%iowait</code>: CPU等待硬件I/O时,所占用CPU百分比.</li>
<li><code>%steal</code>:</li>
<li><code>%idle</code>: CPU空闲时间的百分比.</li>
</ul>
<p>Device:            </p>
<ul>
<li><code>tps</code>: 每秒钟发送到的I/O请求数.</li>
<li><code>Blk_read/s</code>: 每秒读取的block数.</li>
<li><code>Blk_wrtn/s</code>: 每秒写入的block数.</li>
<li><code>Blk_read</code>: 读入的block总数.</li>
<li><code>Blk_wrtn</code>: 写入的block总数.</li>
</ul>
<ul>
<li><code>Blk_read</code> 读入块的当总数.</li>
<li><code>Blk_wrtn</code> 写入块的总数.</li>
<li><code>kB_read/s</code> 每秒从驱动器读入的数据量,单位为K.</li>
<li><code>kB_wrtn/s</code> 每秒向驱动器写入的数据量,单位为K.</li>
<li><code>kB_read</code> 读入的数据总量,单位为K.</li>
<li><code>kB_wrtn</code> 写入的数据总量,单位为K.</li>
<li><code>rrqm/s</code>  将读入请求合并后,每秒发送到设备的读入请求数.</li>
<li><code>wrqm/s</code>  将写入请求合并后,每秒发送到设备的写入请求数.</li>
<li><code>r/s</code>     每秒发送到设备的读入请求数.</li>
<li><code>w/s</code>     每秒发送到设备的写入请求数.</li>
<li><code>rsec/s</code>  每秒从设备读入的扇区数.</li>
<li><code>wsec/s</code>  每秒向设备写入的扇区数.</li>
<li><code>rkB/s</code>  每秒从设备读入的数据量,单位为K.</li>
<li><code>wkB/s</code>  每秒向设备写入的数据量,单位为K.</li>
<li><code>avgrq-sz</code>  发送到设备的请求的平均大小,单位是扇区.</li>
<li><code>avgqu-sz</code> 发送到设备的请求的平均队列长度.</li>
<li><code>await</code>  I/O请求平均执行时间.包括发送请求和执行的时间.单位是毫秒.</li>
<li><code>svctm</code> 发送到设备的I/O请求的平均执行时间.单位是毫秒.</li>
<li><code>%util</code>  在I/O请求发送到设备期间,占用CPU时间的百分比.用于显示设备的带宽利用率.当这个值接近100%时,表示设备带宽已经占满.</li>
</ul>
<h3 id="uname"><a href="#uname" class="headerlink" title="uname"></a>uname</h3><ul>
<li><code>-a</code> 　显示全部的信息。</li>
<li><code>-m</code>　显示电脑类型。</li>
<li><code>-n</code>　显示在网络上的主机名称。</li>
<li><code>-r</code>　显示操作系统的发行编号。</li>
<li><code>-s</code>　显示操作系统名称。</li>
<li><code>-v</code> 　显示操作系统的版本。</li>
</ul>
<h3 id="sar"><a href="#sar" class="headerlink" title="sar"></a>sar</h3><p>系统报告命令</p>
<ul>
<li><code>sar -q 1 5</code>    察看cpu的load状况，每1s钟统计1次，共统计5次</li>
<li><code>sar -u 2 3</code>   察看cpu使用率，每2s统计1次，共统计3次</li>
<li><code>sar -r</code>   察看当日内存占用情况(默认每10分钟统计一次)</li>
<li><code>sar -b</code> 察看当日IO使用情况</li>
<li><code>sar -n SOCK</code>   察看网络sock连接</li>
<li><code>sar -n DEV</code> 察看网络流量</li>
</ul>
<h3 id="top"><a href="#top" class="headerlink" title="top"></a>top</h3><h3 id="df"><a href="#df" class="headerlink" title="df"></a>df</h3><p>检查文件系统的磁盘空间占用情况</p>
<ul>
<li><code>-a</code> 显示所有文件系统的磁盘使用情况，包括0块（block）的文件系统，如/proc文件系统。</li>
<li><code>-k</code> 以k字节为单位显示。</li>
<li><code>-i</code> 显示i节点信息，而不是磁盘块。</li>
<li><code>-t</code> 显示各指定类型的文件系统的磁盘空间使用情况。</li>
<li><code>-x</code> 列出不是某一指定类型文件系统的磁盘空间使用情况（与t选项相反）。</li>
<li><code>-T</code> 显示文件系统类型。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">文件系统                 1K-块      已用      可用 已用% 挂载点</span><br><span class="line">/dev/sda2             10079084   6660892   2906192  70% /</span><br><span class="line">tmpfs                  8141376         0   8141376   0% /dev/shm</span><br><span class="line">/dev/sda1             10079084    173308   9393776   2% /boot</span><br><span class="line">/dev/sda5            257592732 241557292   2950464  99% /opt</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="du"><a href="#du" class="headerlink" title="du"></a>du</h3><p>显示每个文件和目录的磁盘使用空间。</p>
<ul>
<li><code>-a或-all</code>  显示目录中个别文件的大小。   </li>
<li><code>-b或-bytes</code>  显示目录或文件大小时，以byte为单位。   </li>
<li><code>-c或--total</code>  除了显示个别目录或文件的大小外，同时也显示所有目录或文件的总和。</li>
<li><code>-k或--kilobytes</code>  以KB(1024bytes)为单位输出。</li>
<li><code>-m或--megabytes</code>  以MB为单位输出。   </li>
<li><code>-s或--summarize</code>  仅显示总计，只列出最后加总的值。</li>
<li><code>-h或--human-readable</code>  以K，M，G为单位，提高信息的可读性。</li>
<li><code>-x或--one-file-xystem</code>  以一开始处理时的文件系统为准，若遇上其它不同的文件系统目录则略过。</li>
<li><code>-L&lt;符号链接&gt;或--dereference&lt;符号链接&gt;</code> 显示选项中所指定符号链接的源文件大小。   </li>
<li><code>-S或--separate-dirs</code>   显示个别目录的大小时，并不含其子目录的大小。</li>
<li><code>-X&lt;文件&gt;或--exclude-from=&lt;文件&gt;</code>  在&lt;文件&gt;指定目录或文件。   </li>
<li><code>--exclude=&lt;目录或文件&gt;</code>         略过指定的目录或文件。    </li>
<li><code>-D或--dereference-args</code>   显示指定符号链接的源文件大小。   </li>
<li><code>-H或--si</code>  与-h参数相同，但是K，M，G是以1000为换算单位。   </li>
<li><code>-l或--count-links</code>   重复计算硬件链接的文件。  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 对当前目前下所有文件按文件大小倒排序，大小相同按文件名字母倒排序</span><br><span class="line">du -ak | sort -t$&apos;\t&apos; -l1 -nr -k2 -r</span><br></pre></td></tr></table></figure>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/linux/Linux系统命令/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/linux/Linux系统命令/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/linux/Linux常用命令/" title="Linux常用命令" itemprop="url">Linux常用命令</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-10-14T16:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h2><p>将文件或者文件夹压缩成后缀为<code>.gz</code>的文件</p>
<ul>
<li><code>-a</code> 　使用ASCII文字模式.</li>
<li><code>-c</code> 　把压缩后的文件输出到标准输出设备,不去更动原始文件.</li>
<li><code>-d</code> 　解开压缩文件.</li>
<li><code>-f</code> 　强行压缩文件.不理会文件名称或硬连接是否存在以及该文件是否为符号连接.</li>
<li><code>-l</code> 　列出压缩文件的相关信息.</li>
<li><code>-L</code> 　显示版本与版权信息.</li>
<li><code>-n</code> 　压缩文件时,不保存原来的文件名称及时间戳记.</li>
<li><code>-N</code> 　压缩文件时,保存原来的文件名称及时间戳记.</li>
<li><code>-q</code> 　不显示警告信息.</li>
<li><code>-r</code> 　递归处理,将指定目录下的所有文件及子目录一并处理.</li>
<li><code>-S</code> 　更改压缩字尾字符串.</li>
<li><code>-t</code> 　测试压缩文件是否正确无误.</li>
<li><code>-v</code> 　显示指令执行过程.</li>
<li><code>-num</code> 用指定的数字num调整压缩的速度,-1或–fast表示最快压缩方法（低压缩比）,-9或–best表示最慢压缩方法（高压缩比）.系统缺省值为6.</li>
</ul>
<p>常用命令</p>
<ul>
<li><code>gzip *</code>  把test6目录下的每个文件压缩成.gz文件</li>
<li><code>gzip -dv *</code> 把例1中每个压缩的文件解压,并列出详细的信息</li>
<li><code>gzip -l *</code> 详细显示例1中每个压缩的文件的信息,并不解压</li>
<li><code>gzip -r log.tar</code> 压缩一个tar备份文件,此时压缩文件的扩展名为.tar.gz</li>
<li><code>gzip -rv test6</code> 递归的压缩目录</li>
<li><code>gzip -dr test6</code> 递归地解压目录</li>
</ul>
<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p>一种强大的文本搜索工具,它能使用正则表达式搜索文本,并把匹 配的行打印出来</p>
<p>主要参数：</p>
<ul>
<li><code>－c</code>：只输出匹配行的计数.</li>
<li><code>－I</code>：不区分大小写(只适用于单字符).</li>
<li><code>－h</code>：查询多文件时不显示文件名.</li>
<li><code>－l</code>：查询多文件时只输出包含匹配字符的文件名.</li>
<li><code>－n</code>：显示匹配行及行号.</li>
<li><code>－s</code>：不显示不存在或无匹配文本的错误信息.</li>
<li><code>－v</code>：显示不包含匹配文本的所有行.</li>
</ul>
<p>pattern正则表达式主要参数：</p>
<ul>
<li><code>\</code>： 忽略正则表达式中特殊字符的原有含义.</li>
<li><code>^</code>：匹配正则表达式的开始行.</li>
<li><code>$</code>: 匹配正则表达式的结束行.</li>
<li><code>\&lt;</code>：从匹配正则表达 式的行开始.</li>
<li><code>\&gt;</code>：到匹配正则表达式的行结束.</li>
<li><code>[ ]</code>：单个字符,如[A]即A符合要求 .</li>
<li><code>[ - ]</code>：范围,如[A-Z],即A、B、C一直到Z都符合要求 .</li>
<li><code>.</code>：所有的单个字符.</li>
<li><code>*</code> ：有字符,长度可以为0.</li>
</ul>
<h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><p>tar可用于建立、还原、查看、管理文件,也可方 便的追加新文件到备份文件中,或仅更新部分的备份文件,以及解压、删除指定的文件</p>
<h2 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h2><p>sort将文件的每一行作为一个单位,相互比较,比较原则是从首字符向后,依次按ASCII码值进行比较,最后将他们按升序输出.</p>
<p>命令参数</p>
<ul>
<li><code>-u</code> 在输出行中去除重复行.</li>
<li><code>-r</code> sort默认的排序方式是升序,加-r改成降序</li>
<li><code>-o</code> 将排序结果输出到原文件,而使用重定向是不可以的.</li>
<li><code>-n</code> sort命令默认是按照字符排序的,如果遇到数字的字符, 可能会出现1大于10的情况, 所以我们可以设定<code>-n</code>选项, 将其按照数字排序</li>
<li><code>-t</code> 设定间隔符. 设置间隔符,就会将每一行分割成一个数组,我们可以使用-k参数指定按照某列排序</li>
<li><code>-k</code> -t指定了间隔符之后,可以用-k指定基于某列排序.</li>
<li><code>-f</code> 会将小写字母都转换为大写字母来进行比较,亦即忽略大小写</li>
<li><code>-c</code> 会检查文件是否已排好序,如果乱序,则输出第一个乱序的行的相关信息,最后返回1</li>
<li><code>-C</code> 会检查文件是否已排好序,如果乱序,不输出内容,仅返回1</li>
<li><code>-M</code> 会以月份来排序,比如JAN小于FEB等等</li>
<li><code>-b</code> 会忽略每一行前面的所有空白部分,从第一个可见字符开始比较.</li>
</ul>
<h2 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h2><p>统计指定文件中的字节数、字数、行数,并将统计结果显示输出.该命令统计指定文件中的字节数、字数、行数.如果没有给出文件名,则从标准输入读取.wc同时也给出所指定文件的总统计数.</p>
<ul>
<li><code>-c</code> 统计字节数.</li>
<li><code>-l</code> 统计行数.</li>
<li><code>-m</code> 统计字符数.这个标志不能与 -c 标志一起使用.</li>
<li><code>-w</code> 统计字数.一个字被定义为由空白、跳格或换行字符分隔的字符串.</li>
<li><code>-L</code> 打印最长行的长度.</li>
</ul>
<h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p><code>find pathname -options [-print -exec -ok ...]</code></p>
<p>命令参数；<br><code>pathname</code>: 要查找的路径.<br><code>-print</code>： find命令将匹配的文件输出到标准输出.<br><code>-exec</code>： 匹配到合适文件后执行的shell命令.相应命令的形式为<code>&#39;command&#39; { } ;</code>(注意{ }和；之间的空格).<br><code>-ok</code>： 和-exec的作用相同,但是在执行命令之前,都会给出提示确认是否真的执行.</p>
<p>options选项</p>
<ul>
<li><code>-name</code> 要查找的文件名(可以使用正则).</li>
<li><code>-perm</code> 按照文件权限查找文件.</li>
<li><code>-prune</code> 使用这一选项可以使find命令不在当前指定的目录中查找,如果同时使用-depth选项,那么-prune将被find命令忽略.</li>
<li><code>-user</code> 按照文件属主来查找文件.</li>
<li><code>-group</code> 按照文件所属的组来查找文件.</li>
<li><code>-mtime -n +n</code> 按照文件的更改时间来查找文件, - n表示文件更改时间距现在n天以内,+ n表示文件更改时间距现在n天以前.</li>
<li><code>-nogroup</code> 查找无有效所属组的文件,即该文件所属的组在/etc/groups中不存在.</li>
<li><code>-nouser</code> 查找无有效属主的文件,即该文件的属主在/etc/passwd中不存在.</li>
<li><code>-newer file1 ! file2</code> 查找更改时间比文件file1新但比文件file2旧的文件.</li>
<li><code>-type</code> 查找某一类型的文件(例如: <code>-b</code>块设备文件. <code>-d</code>目录. <code>-c</code>字符设备文件. <code>-p</code>管道文件. <code>-l</code>符号链接文件. <code>-f</code>普通文件.)</li>
<li><code>-size n [c]</code>：查找文件长度为n块的文件,带有c时表示文件长度以字节计.</li>
<li><code>-depth</code>：在查找文件时,首先查找当前目录中的文件,然后再在其子目录中查找.</li>
<li><code>-mount</code>：在查找文件时不跨越文件系统mount点.</li>
<li><code>-follow</code>：如果find命令遇到符号链接文件,就跟踪至链接所指向的文件.</li>
</ul>
<p>另外,下面三个的区别:</p>
<ul>
<li><code>-amin n</code>  查找系统中最后N分钟访问的文件</li>
<li><code>-atime n</code> 查找系统中最后n*24小时访问的文件</li>
<li><code>-cmin n</code>  查找系统中最后N分钟被改变文件状态的文件</li>
<li><code>-ctime n</code> 查找系统中最后n*24小时被改变文件状态的文件</li>
<li><code>-mmin n</code>  查找系统中最后N分钟被改变文件数据的文件</li>
<li><code>-mtime n</code> 查找系统中最后n*24小时被改变文件数据的文件</li>
</ul>
<h2 id="grep-1"><a href="#grep-1" class="headerlink" title="grep"></a>grep</h2><p>用法: <code>grep [选项]... PATTERN [FILE]...</code>. 在每个 FILE 或是标准输入中查找 PATTERN。默认的 PATTERN 是一个基本正则表达式(缩写为 BRE)。<br>例如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -i &apos;hello world&apos; menu.h main.c</span><br></pre></td></tr></table></figure></p>
<p>正则表达式选择与解释:</p>
<ul>
<li>-E, –extended-regexp     PATTERN 是一个可扩展的正则表达式(缩写为 ERE)</li>
<li>-F, –fixed-strings       PATTERN 是一组由断行符分隔的定长字符串。</li>
<li>-G, –basic-regexp        PATTERN 是一个基本正则表达式(缩写为 BRE)</li>
<li>-P, –perl-regexp         PATTERN 是一个 Perl 正则表达式</li>
<li>-e, –regexp=PATTERN      用 PATTERN 来进行匹配操作</li>
<li>-f, –file=FILE           从 FILE 中取得 PATTERN</li>
<li>-i, –ignore-case         忽略大小写</li>
<li>-w, –word-regexp         强制 PATTERN 仅完全匹配字词</li>
<li>-x, –line-regexp         强制 PATTERN 仅完全匹配一行</li>
<li>-z, –null-data           一个 0 字节的数据行，但不是空行</li>
</ul>
<p>Output control:</p>
<ul>
<li>-m, –max-count=NUM       只获得前m个匹配结果</li>
<li>-b, –byte-offset         在输出的内容中打印byte offset</li>
<li>-n, –line-number         输出行号</li>
<li>–line-buffered       每一行都输出, 不再行上进行缓存</li>
<li>-H, –with-filename       输出文件名</li>
<li>-h, –no-filename         不输出文件名</li>
<li>-o, –only-matching       仅仅输出一行中符合 PATTERN模式 匹配要求的部分</li>
<li>-a, –text                等同于 –binary-files=text</li>
<li>-I                        等同于 –binary-files=without-match</li>
<li>-d, –directories=ACTION  处理目录方式; <code>read&#39;,</code>recurse’, or `skip’</li>
<li>-D, –devices=ACTION      处理 devices, FIFOs and sockets的方式: <code>read&#39; or</code>skip’</li>
<li>-R, -r, –recursive       equivalent to –directories=recurse</li>
<li>–include=FILE_PATTERN  仅对符合FILE_PATTERN模式的文件进行搜索</li>
<li>–exclude=FILE_PATTERN  跳过符合FILE_PATTERN的文件和目录</li>
<li>–exclude-from=FILE   跳过符合FILE中file pattern所有的文件</li>
<li>–exclude-dir=PATTERN  符合PATTERN模式的目录将被跳过.</li>
<li>-L, –files-without-match  只输出匹配失败的文件名</li>
<li>-l, –files-with-matches  只输出匹配成功的文件名</li>
<li>-c, –count               只输出每个文件匹配成功的行数</li>
<li>-Z, –null                在文件名后输出0 byte</li>
</ul>
<p>Context control:</p>
<ul>
<li>-B, –before-context=NUM  显示匹配字符串前n行的数据</li>
<li>-A, –after-context=NUM   显示匹配字符串后n行的数据</li>
<li>-C, –context=NUM         print NUM lines of output context</li>
<li>-NUM                      和 –context=NUM 一样</li>
</ul>
<p>当前目录下有多个文件我们想要同时对所有文件进行搜索的话, 我们可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;刷新&quot; *</span><br></pre></td></tr></table></figure></p>
<p>如果我们只想对今天的文件进行搜索的话, 可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;刷新&quot; *2016-02-02*</span><br></pre></td></tr></table></figure></p>
<p>如果我们的目录下有多个目录, 要搜索的文件都在当前的子目录里的话, 可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep --directories=recurse &quot;刷新&quot; *</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/linux/Linux常用命令/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/linux/Linux常用命令/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/mgits/技术CheckList/" title="技术CheckList" itemprop="url">技术CheckList</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-10-14T16:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="FastJSON"><a href="#FastJSON" class="headerlink" title="FastJSON"></a>FastJSON</h2><h3 id="序列化bug"><a href="#序列化bug" class="headerlink" title="序列化bug"></a>序列化bug</h3><p>在项目中运营团队给出了下面这样的一个公告<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">================================================</span><br><span class="line">官方QQ群： <span class="number">467027422</span></span><br><span class="line">官方微信号：gm-xyxmp</span><br><span class="line">微信订阅号：xyxmpsy</span><br><span class="line"></span><br><span class="line">亲爱的小伙伴：</span><br><span class="line"></span><br><span class="line">大家好，老猪给各位请安了！</span><br><span class="line"></span><br><span class="line">首款能交易的<span class="number">3</span>D卡牌游戏，星爷独家正版授权《西游降魔篇<span class="number">3</span>D》</span><br><span class="line">自<span class="number">2015</span>年<span class="number">7</span>月<span class="number">21</span>日正式登陆iOS平台后，大量玩家热情涌入游戏</span><br><span class="line">，老猪我面对此景喜极而泣，为了让更多小伙伴加入到咱们的</span><br><span class="line">大团队中，老猪我决定[FFFF00]<span class="number">10</span>月<span class="number">16</span>日<span class="number">11</span>：<span class="number">00</span>开启新服N23-物华天宝 [-]，</span><br><span class="line">诚邀各位新老玩家的加入！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">新服开启，精彩纷呈的活动期待各位的参与，丰厚的大礼拿到手</span><br><span class="line">抽筋，在《西游降魔篇<span class="number">3</span>D》西行的途中，让我们一同感受友情，</span><br><span class="line">感受激情，感受无限快乐！</span><br><span class="line"></span><br><span class="line">服务器名称：[FFFF00]N23-物华天宝 [-]</span><br><span class="line">开服时间：[FFFF00]<span class="number">2015</span>年<span class="number">10</span>月<span class="number">16</span>日<span class="number">11</span>：<span class="number">00</span>（周五）[-]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">伴随开服的同时，多个活动前来助阵！</span><br><span class="line">[FFFF00]活动一：连续登陆送豪礼[-]</span><br><span class="line">[FFFF00]活动二：冲级领元宝[-]</span><br><span class="line">[FFFF00]活动三：战力大比拼[-]</span><br><span class="line">[FFFF00]活动四：五星神将双倍抽[-]</span><br><span class="line">[FFFF00]活动五：天天有礼送段小姐[-]</span><br><span class="line">[FFFF00]活动六：累积充值送玉帝[-]</span><br><span class="line">[FFFF00]活动七：每日礼包大回馈[-]</span><br><span class="line">[FFFF00]活动八：首充翻倍送豪礼[-]</span><br><span class="line">[FFFF00]活动九：签到送好礼[-]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">活动详情请查看游戏内公告！</span><br><span class="line">================================================</span><br><span class="line">                                                            《西游降魔篇<span class="number">3</span>D》运营团队</span><br></pre></td></tr></table></figure></p>
<p>当我将其赋值到一个对象<code>obj#value</code>时,然后使用<code>JSON.toJSONString(obj)</code>的时候遇到了下面的异常:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.ArrayIndexOutOfBoundsException: <span class="number">160</span></span><br><span class="line">	at com.alibaba.fastjson.serializer.SerializeWriter.writeStringWithDoubleQuote(SerializeWriter.java:<span class="number">868</span>)</span><br><span class="line">	at com.alibaba.fastjson.serializer.SerializeWriter.writeStringWithDoubleQuote(SerializeWriter.java:<span class="number">602</span>)</span><br><span class="line">	at com.alibaba.fastjson.serializer.SerializeWriter.writeString(SerializeWriter.java:<span class="number">1366</span>)</span><br><span class="line">	at com.alibaba.fastjson.serializer.StringCodec.write(StringCodec.java:<span class="number">49</span>)</span><br><span class="line">	at com.alibaba.fastjson.serializer.StringCodec.write(StringCodec.java:<span class="number">34</span>)</span><br><span class="line">	at com.alibaba.fastjson.serializer.JSONSerializer.write(JSONSerializer.java:<span class="number">369</span>)</span><br><span class="line">	at com.alibaba.fastjson.JSON.toJSONString(JSON.java:<span class="number">430</span>)</span><br><span class="line">	at com.alibaba.fastjson.JSON.toJSONString(JSON.java:<span class="number">418</span>)</span><br><span class="line">	at Print1.main(Print1.java:<span class="number">52</span>)</span><br></pre></td></tr></table></figure></p>
<p>出现的原因是:<code>服务器名称：[FFFF00]N23-物华天宝 [-]</code>物华天宝后面跟的空格，不是我们常用的ascii码为32的空格，而是一个ascii码为160特殊的空格符,导致JSON序列化时失败.</p>
<h2 id="用户名字符集"><a href="#用户名字符集" class="headerlink" title="用户名字符集"></a>用户名字符集</h2><p>用户可能输入emoji表情符号,这种符号普遍存在iOS与android系统中,这种表情不处理直接存储到MySQL5.5以下的版本会报错</p>
<blockquote>
<p>这种符号采用Unicode 6标准4个bytes作为存储单元,MySQL存储这种字符需要修改数据库字符集为utf8mb4,但数据回传给网页或者移动客户端时则需要做兼容处理</p>
</blockquote>
<h2 id="日志问题"><a href="#日志问题" class="headerlink" title="日志问题"></a>日志问题</h2><p>在项目的开发过程中不允许使用debug模式, 一定要使用日志分析问题, 因为在线上时候, 没办法使用debug的方式, 因此在记录的日志的时候, 一定要记录的全(每个数据变化都要记录下来), 简(剩下来的就是钱)</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/mgits/">mgits</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/mgits/技术CheckList/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/mgits/技术CheckList/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/linux/linux系统文件/" title="Linux系统文件" itemprop="url">Linux系统文件</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-10-14T16:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="proc-cpuinfo"><a href="#proc-cpuinfo" class="headerlink" title="/proc/cpuinfo"></a>/proc/cpuinfo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@cvs /]# cat /proc/cpuinfo</span><br><span class="line">processor       : 0</span><br><span class="line">vendor_id       : GenuineIntel</span><br><span class="line">cpu family      : 6</span><br><span class="line">model           : 45</span><br><span class="line">model name      : Intel(R) Xeon(R) CPU E5-2603 0 @ 1.80GHz</span><br><span class="line">stepping        : 7</span><br><span class="line">cpu MHz         : 1800.009</span><br><span class="line">cache size      : 10240 KB</span><br><span class="line">physical id     : 0</span><br><span class="line">siblings        : 4</span><br><span class="line">core id         : 0</span><br><span class="line">cpu cores       : 4</span><br><span class="line">apicid          : 0</span><br><span class="line">initial apicid  : 0</span><br><span class="line">fpu             : yes</span><br><span class="line">fpu_exception   : yes</span><br><span class="line">cpuid level     : 13</span><br><span class="line">wp              : yes</span><br><span class="line">flags           : fpu vme de pse tsc msr pae mce ...</span><br><span class="line">bogomips        : 3600.01</span><br><span class="line">clflush size    : 64</span><br><span class="line">cache_alignment : 64</span><br><span class="line">address sizes   : 46 bits physical, 48 bits virtual</span><br><span class="line">power management:</span><br></pre></td></tr></table></figure>
<ul>
<li><code>processor</code>       : CPU号</li>
<li><code>vendor_id</code>       : CPU制造商   </li>
<li><code>cpu family</code>      : CPU产品系列代号</li>
<li><code>model</code>           : CPU属于其系列中的哪一代的代号</li>
<li><code>model name</code>      : CPU属于的名字及其编号、标称主频</li>
<li><code>stepping</code>        : CPU属于制作更新版本</li>
<li><code>cpu MHz</code>         : CPU的实际使用主频</li>
<li><code>cache size</code>      : CPU二级缓存大小</li>
<li><code>physical id</code>     : 单个CPU的标号</li>
<li><code>siblings</code>        : 单个CPU逻辑物理核数</li>
<li><code>core id</code>         : 当前物理核在其所处CPU中的编号，这个编号不一定连续</li>
<li><code>cpu cores</code>       : 该逻辑核所处CPU的物理核数</li>
<li><code>apicid</code>          : 用来区分不同逻辑核的编号，系统中每个逻辑核的此编号必然不同，此编号不一定连续</li>
<li><code>initial apicid</code>  :</li>
<li><code>fpu</code>             : 是否具有浮点运算单元（Floating Point Unit）</li>
<li><code>fpu_exception</code>   : 是否支持浮点计算异常</li>
<li><code>cpuid level</code>     : 执行cpuid指令前，eax寄存器中的值，根据不同的值cpuid指令会返回不同的内容</li>
<li><code>wp</code>              : 表明当前CPU是否在内核态支持对用户空间的写保护（Write Protection）</li>
<li><code>flags</code>           : 当前CPU支持的功能</li>
<li><code>bogomips</code>        : 在系统内核启动时粗略测算的CPU速度（Million Instructions Per Second）</li>
<li><code>clflush size</code>    : 每次刷新缓存的大小单位</li>
<li><code>cache_alignment</code> : 缓存地址对齐单位</li>
<li><code>address sizes</code>   : 可访问地址空间位数</li>
<li><code>power management</code>: 对能源管理的支持，有以下几个可选支持功能</li>
</ul>
<h3 id="proc-meminfo"><a href="#proc-meminfo" class="headerlink" title="/proc/meminfo"></a>/proc/meminfo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@cvs /]# cat /proc/meminfo</span><br><span class="line">MemTotal:       16282756 kB</span><br><span class="line">MemFree:         2012664 kB</span><br><span class="line">Buffers:          491980 kB</span><br><span class="line">Cached:          5477644 kB</span><br><span class="line">SwapCached:       110344 kB</span><br><span class="line">Active:          9224100 kB</span><br><span class="line">Inactive:        4478716 kB</span><br><span class="line">Active(anon):    6410680 kB</span><br><span class="line">Inactive(anon):  1322576 kB</span><br><span class="line">Active(file):    2813420 kB</span><br><span class="line">Inactive(file):  3156140 kB</span><br><span class="line">Unevictable:           0 kB</span><br><span class="line">Mlocked:               0 kB</span><br><span class="line">SwapTotal:      10239992 kB</span><br><span class="line">SwapFree:        8921364 kB</span><br><span class="line">Dirty:              1176 kB</span><br><span class="line">Writeback:             0 kB</span><br><span class="line">AnonPages:       7679964 kB</span><br><span class="line">Mapped:            25344 kB</span><br><span class="line">Shmem:                36 kB</span><br><span class="line">Slab:             328340 kB</span><br><span class="line">SReclaimable:     284284 kB</span><br><span class="line">SUnreclaim:        44056 kB</span><br><span class="line">KernelStack:        8504 kB</span><br><span class="line">PageTables:        27520 kB</span><br><span class="line">NFS_Unstable:          0 kB</span><br><span class="line">Bounce:                0 kB</span><br><span class="line">WritebackTmp:          0 kB</span><br><span class="line">CommitLimit:    18381368 kB</span><br><span class="line">Committed_AS:   11103356 kB</span><br><span class="line">VmallocTotal:   34359738367 kB</span><br><span class="line">VmallocUsed:      307784 kB</span><br><span class="line">VmallocChunk:   34350792204 kB</span><br><span class="line">HardwareCorrupted:     0 kB</span><br><span class="line">AnonHugePages:   6842368 kB</span><br><span class="line">HugePages_Total:       0</span><br><span class="line">HugePages_Free:        0</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">DirectMap4k:        5056 kB</span><br><span class="line">DirectMap2M:     2045952 kB</span><br><span class="line">DirectMap1G:    14680064 kB</span><br></pre></td></tr></table></figure>
<ul>
<li><code>MemTotal</code>:</li>
<li><code>MemFree</code>:空闲内存</li>
<li><code>Buffers</code>:给文件的缓冲大小</li>
<li><code>Cached</code>: 高速缓冲存储器(<a href="http://baike.baidu.com/view/496990.htm)使用的大小" target="_blank" rel="external">http://baike.baidu.com/view/496990.htm)使用的大小</a></li>
<li><code>SwapCached</code>: 被高速缓冲存储用的交换空间大小</li>
<li><code>Active</code>: 活跃使用中的高速缓冲存储器页面文件大小</li>
<li><code>Inactive</code>: 不经常使用的高速缓冲存储器页面文件大小</li>
<li><code>Active(anon)</code>:</li>
<li><code>Inactive(anon)</code>:</li>
<li><code>Active(file)</code>:</li>
<li><code>Inactive(file)</code>:</li>
<li><code>Unevictable</code>:</li>
<li><code>Mlocked</code>:</li>
<li><code>SwapTotal</code>:交换空间总大小</li>
<li><code>SwapFree</code>: 空闲交换空间</li>
<li><code>Dirty</code>:等待被写回到磁盘的大小</li>
<li><code>Writeback</code>:正在被写回的大小</li>
<li><code>AnonPages</code>:未映射的页的大小</li>
<li><code>Mapped</code>: 设备和文件映射的大小</li>
<li><code>Shmem</code>:</li>
<li><code>Slab</code>: 内核数据结构缓存的大小，可减少申请和释放内存带来的消耗</li>
<li><code>SReclaimable</code>: 可收回slab的大小</li>
<li><code>SUnreclaim</code>: 不可收回的slab的大小23204+14164=37368</li>
<li><code>KernelStack</code>:</li>
<li><code>PageTables</code>: 管理内存分页的索引表的大小</li>
<li><code>NFS_Unstable</code>: 不稳定页表的大小</li>
<li><code>Bounce</code>: bounce:退回</li>
<li><code>WritebackTmp</code>:</li>
<li><code>CommitLimit</code>:</li>
<li><code>Committed_AS</code>:</li>
<li><code>VmallocTotal</code>: 虚拟内存大小</li>
<li><code>VmallocUsed</code>:已经被使用的虚拟内存大小</li>
<li><code>VmallocChunk</code>:</li>
<li><code>HardwareCorrupted</code>:</li>
<li><code>AnonHugePages</code>:</li>
<li><code>HugePages_Total</code>:大页面的分配</li>
<li><code>HugePages_Free</code>:</li>
<li><code>HugePages_Rsvd</code>:</li>
<li><code>HugePages_Surp</code>:</li>
<li><code>Hugepagesize</code>:</li>
<li><code>DirectMap4k</code>:</li>
<li><code>DirectMap2M</code>:</li>
<li><code>DirectMap1G</code>:</li>
</ul>
<h3 id="proc-net-dev"><a href="#proc-net-dev" class="headerlink" title="/proc/net/dev"></a>/proc/net/dev</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@cvs /]# cat /proc/net/dev</span><br><span class="line">Inter-|   Receive                                                |  Transmit</span><br><span class="line"> face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed</span><br><span class="line">    lo:365528559149 865504543    0    0    0     0          0         0 365528559149 865504543    0    0    0     0       0          0</span><br><span class="line">   em1:542483270223 575346473    0    0    0    62          0   8267561 580200919340 586706511    0    0    0     0       0          0</span><br><span class="line">   em2:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0</span><br><span class="line">   em3:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0</span><br><span class="line">   em4:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0</span><br></pre></td></tr></table></figure>
<p>Inter                                                     </p>
<ul>
<li><code>face</code>:接口的名字</li>
</ul>
<p>Receive</p>
<ul>
<li><code>bytes</code>: 收发的字节数   </li>
<li><code>packets</code>: 收发正确的包量</li>
<li><code>errs</code>: 收发错误的包量</li>
<li><code>drop</code>: 收发丢弃的包量</li>
<li><code>fifo</code>:</li>
<li><code>frame</code>:</li>
<li><code>compressed</code>:</li>
<li><code>multicast</code>:</li>
</ul>
<p>Transmit</p>
<ul>
<li><code>bytes</code>: 收发的字节数   </li>
<li><code>packets</code>: 收发正确的包量</li>
<li><code>errs</code>: 收发错误的包量</li>
<li><code>drop</code>: 收发丢弃的包量</li>
<li><code>fifo</code>:</li>
<li><code>colls</code>:</li>
<li><code>carrier</code>:</li>
<li><code>compressed</code>:</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/linux/linux系统文件/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/linux/linux系统文件/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/12/并发编程/1_1_双线程锁/" title="双线程锁" itemprop="url">双线程锁</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-10-11T16:00:00.000Z" itemprop="datePublished"> Published 2015-10-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>所谓的双线程锁指的是这种锁适用于俩个线程运行的前提下. 下面我们依次给出了三种双线程锁解决方案：</p>
<p>双线程算法遵循以下俩点约定:</p>
<ol>
<li>线程标志为<code>0</code>或者<code>1</code>. 若当前线程调用者的标志为i,则另一方的调用者为1 - i</li>
<li>通过ThreadId.get()获取自己的标志</li>
</ol>
<ul>
<li>互斥: 俩个线程的临界区是没有重叠的,那么我们撑这俩个临界区是互斥的.</li>
<li>无死锁: 如果一个线程尝试获得一个锁,那么总会成功获得这个锁.</li>
<li>无饥饿：每一个尝试获得锁的线程都能成功. 当线程调用一个锁方法的时候,这个方法立即返回,我们便称这个锁是无饥饿的.</li>
</ul>
<h2 id="LockOne"><a href="#LockOne" class="headerlink" title="LockOne"></a>LockOne</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LockOne</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span>[] flags = <span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">2</span>];</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> i = ThreadID.get();</span><br><span class="line">		<span class="keyword">int</span> j = <span class="number">1</span>- i;</span><br><span class="line">		flag[i] = <span class="keyword">true</span>;</span><br><span class="line">		<span class="keyword">while</span>(flag[j]) &#123;&#125;		</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> i = ThreadID.get();</span><br><span class="line">		flag[i] = <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>假设线程A对应flag[0]标志,线程B对应flag[1]标志,那么我们得出下面这一个流程:</p>
<ol>
<li><code>write_A(flag[0] = true) -&gt; read_A(flag[1] == false) -&gt; CS_A</code>这段话的意思是线程A将<code>flag[0]</code>的值置为true然后读取<code>flag[1]</code>的值,这个过程称为<code>CS_A</code>事件</li>
<li><code>write_B(flag[1] = true) -&gt; read_B(flag[0] == false) -&gt; CS_B</code>这段话的意思是线程B将<code>flag[1]</code>的值置为true然后读取<code>flag[0]</code>的值,这个过程称为<code>CS_B</code>事件</li>
</ol>
<blockquote>
<p>我们验证一下LockOne算法是否满足互斥<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">假设这个算法不是互斥的，也就是无法得到`CS_A -&gt; CS_B`且`CS_B -&gt; CS_A`.</span><br><span class="line">假设CS_A事件先于CS_B事件,那么有：</span><br><span class="line">write_A(flag[<span class="number">0</span>] = <span class="keyword">true</span>) -&gt; read_A(flag[<span class="number">1</span>] == <span class="keyword">false</span>) -&gt; write_B(flag[<span class="number">1</span>] = <span class="keyword">true</span>)</span><br><span class="line">=&gt;</span><br><span class="line">read_A(flag[<span class="number">1</span>] == <span class="keyword">false</span>) -&gt; write_B(flag[<span class="number">1</span>] = <span class="keyword">true</span>)</span><br><span class="line">可以看到这俩个事件是互斥的(它们的临界区是没有重叠的).</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>LockOne算法满足了互斥,但是如果俩个线程并发执行的话，就会进入死锁,同样我们来证明一下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">假设</span><br><span class="line">write_A(flag[<span class="number">0</span>] = <span class="keyword">true</span>) -&gt; write_B(flag[<span class="number">1</span>] = <span class="keyword">true</span>) -&gt; read_A(flag[<span class="number">1</span>] == <span class="keyword">false</span>) -&gt; read_B(flag[<span class="number">0</span>] == <span class="keyword">false</span>)</span><br><span class="line">那么`flag[<span class="number">0</span>]`和`flag[<span class="number">1</span>]`就都成为<span class="keyword">true</span>,也就是线程A和线程B进入了死锁.</span><br></pre></td></tr></table></figure></p>
<p>至于说为什么要使用<code>volatile</code>关键字,这是为了保证<code>flags</code>变量的内存可见性,因为Java会将这段代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(flag[j]) &#123;&#125;</span><br><span class="line">=&gt;</span><br><span class="line"><span class="keyword">if</span>(flag[j]) &#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译后的代码进行了提升优化,加上<code>volatile</code>关键字,就是告诉编译器,不要提升优化我的代码.</p>
<h2 id="LockTwo"><a href="#LockTwo" class="headerlink" title="LockTwo"></a>LockTwo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LockTwo</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> lock;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> tid = ThreadID.get();</span><br><span class="line">		lock = tid;</span><br><span class="line">		<span class="keyword">while</span>(lock == tid)&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> tid = ThreadID.get();</span><br><span class="line">		lock = tid;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样我们假设有俩个事件发生</p>
<ol>
<li><code>write_A(lock = 1) -&gt; read_A(lock == 1) -&gt; CS_A</code></li>
<li><code>write_B(lock = 2) -&gt; read_B(lock == 2) -&gt; CS_B</code><br>很明显任何线程调用加锁操作都会造成死循环. 但是,如果锁调用交叉调用的话<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write_A(lock = <span class="number">1</span>) -&gt; write_B(lock = <span class="number">2</span>) -&gt; read_A(lock == <span class="number">2</span>) -&gt; read_B(lock == <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>直到A线程释放锁,B线程就一直在阻塞着. 因此只要这俩个事件并发执行就能完成互斥要求.</p>
<h2 id="Peterson"><a href="#Peterson" class="headerlink" title="Peterson"></a>Peterson</h2><p>算法实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Peterson</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> voliate <span class="keyword">boolean</span>[] flag = <span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">2</span>];</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> lock;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> tid = ThreadID.get();</span><br><span class="line">		<span class="keyword">int</span> oid = <span class="number">1</span> - tid;</span><br><span class="line">		flag[oid] = <span class="keyword">true</span>;</span><br><span class="line">		lock = tid;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(flag[tid] &amp;&amp; lock == tid) &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> tid = ThreadID.get();</span><br><span class="line">		flag[tid] = <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>同样的我们看看俩个线程依次调用锁过程(假设线程A对应flag[0]标志,线程B对应flag[1]标志)：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">write_A(flag[<span class="number">1</span>] = <span class="keyword">true</span>) -&gt; write_A(lock = <span class="number">0</span>) -&gt; read_A(flag[<span class="number">0</span>] == <span class="keyword">false</span>) -&gt; read_A(lock == <span class="number">0</span>) -&gt; <span class="function">CS_A</span><br><span class="line"><span class="title">write_B</span><span class="params">(flag[<span class="number">0</span>] = <span class="keyword">true</span>)</span> -&gt; <span class="title">write_B</span><span class="params">(lock = <span class="number">1</span>)</span> -&gt; <span class="title">read_B</span><span class="params">(flag[<span class="number">1</span>] == <span class="keyword">true</span>)</span> -&gt; <span class="title">read_B</span><span class="params">(lock == <span class="number">1</span>)</span> -&gt; CS_B</span></span><br></pre></td></tr></table></figure></p>
<p>好，首先我们看一下</p>
<ul>
<li><code>CS_A</code>先于<code>CS_B</code>事件执行的话,那么B线程会进入锁等待.</li>
</ul>
<p><code>CS_A</code>和<code>CS_B</code>事件并发执行我们分俩种情况分析：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write_A(flag[<span class="number">1</span>] = <span class="keyword">true</span>) -&gt; write_A(lock = <span class="number">0</span>) -&gt; write_B(flag[<span class="number">0</span>] = <span class="keyword">true</span>) -&gt; write_B(lock = <span class="number">1</span>) -&gt; read_A(flag[<span class="number">1</span>] == <span class="keyword">true</span>) -&gt; read_A(lock == <span class="number">0</span>) -&gt; read_B(flag[<span class="number">1</span>] == <span class="keyword">true</span>) -&gt; read_B(lock == <span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p>同样的A线程事件先于B线程事件,我们看到A线程并没有进入锁等待,而是B线程进入了锁等待<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write_A(flag[<span class="number">1</span>] = <span class="keyword">true</span>) -&gt; write_A(lock = <span class="number">0</span>) -&gt; write_B(flag[<span class="number">0</span>] = <span class="keyword">true</span>) -&gt; write_B(lock = <span class="number">1</span>) -&gt; read_B(flag[<span class="number">1</span>] == <span class="keyword">true</span>) -&gt; read_B(lock == <span class="number">1</span>) -&gt; read_A(flag[<span class="number">1</span>] == <span class="keyword">true</span>) -&gt; read_A(lock == <span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>我们发现这个锁算法仍然是有问题的.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/并发编程/">并发编程</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/12/并发编程/1_1_双线程锁/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/12/并发编程/1_1_双线程锁/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/08/数据库/数据库事务/" title="数据库事务" itemprop="url">数据库事务</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-10-07T16:00:00.000Z" itemprop="datePublished"> Published 2015-10-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>事务（Transaction）是一个操作序列，它构成了并发执行的基本单元。事务的提出主要是为了解决并发情况下保持数据一致性。</p>
<p>数据库事务具有ACID特性,即</p>
<ul>
<li>原子性： 原子性体现在对事务的修改,要么全部执行要么都不执行</li>
<li>一致性： 保持数据的一致性,例如整数类型的数据大小不能溢出,字符型数据长度不能超过规定范围，保证数据的完整性.</li>
<li>隔离性： 如果数据库并发执行A,B俩个事务,那么在A事务执行完之前对B事务是不可见的,也就是说,B事务是看不见A事务的中间状态的.</li>
<li>持久性： 事务完成后,它对数据库的影响是永久的,即使数据库出现异常也是如此.</li>
</ul>
<p>隔离级别</p>
<ul>
<li><code>Read Uncommitted</code>: 读取未提交的数据,即其他事务已经提交修改但还未提交的数据(这是最低的隔离级别)</li>
<li><code>Read Committed</code>: 读取已经提交的数据,但是在一个事务中,对同一个项,前后俩次读取的结果可能不同.</li>
<li><code>Repetable Read</code>: 可重复读取,在一个事务中,对同一个项,确保前后俩次读取的结果一样</li>
<li><code>Serializable</code>: 可序列话,即数据库的事务是可串行执行的,就像一个事务执行的时候没有别的事务同时在执行<br>我们使用下面的语句来改变数据库的隔离级别<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> [<span class="keyword">SESSION</span>|<span class="keyword">GLOBAL</span>] <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">READ</span> UNCOMMITTED | <span class="keyword">READ</span> COMMITTED | REPEATABLE <span class="keyword">READ</span> | <span class="keyword">SERIALIZABLE</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li>不带<code>SESSION、GLOBAL</code>的SET命令,只对下一个事务有效</li>
<li><code>SET SESSION</code> 为当前会话设置隔离模式</li>
<li><code>SET GLOBAL</code>为以后新建的所有MYSQL连接设置隔离模式（当前连接不包括在内）</li>
</ol>
<p>读写异常</p>
<ul>
<li><code>Lost Update</code>: 俩个事务并发修改同一个数据,A事务提交成功,B事务提交失败回滚后,A事务的修改都可能会丢失</li>
<li><code>Dirty Reads</code>: A事务读取了B事务更新却没有提交的数据</li>
<li><code>Non-Repeatable Reads</code>: 一个事务对同一个数据项的多次读取可能得到不同的结果</li>
<li><code>Second Lost Updates</code>:俩个事务并发修改同一个数据, B事务可能会覆盖掉A事务的修改</li>
<li><code>Phantom Reads</code>: A事务进行前后俩次查询,但是在查询过程中出现了B事务向其中插入数据,那么A事务可能读取到未出现的数据</li>
</ul>
<p>隔离级别与读写异常的关系<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    LU  DR  NRR  SLU  <span class="keyword">PR</span></span><br><span class="line"><span class="keyword">RU</span>  <span class="keyword">N</span>   Y   Y    Y    <span class="built_in">Y</span></span><br><span class="line">RC  <span class="keyword">N</span>   <span class="keyword">N</span>   Y    Y    <span class="built_in">Y</span></span><br><span class="line">RR  <span class="keyword">N</span>   <span class="keyword">N</span>   <span class="keyword">N</span>   <span class="keyword">N</span>     <span class="built_in">Y</span></span><br><span class="line">S   <span class="keyword">N</span>   <span class="keyword">N</span>   <span class="keyword">N</span>   <span class="keyword">N</span>     <span class="keyword">N</span></span><br></pre></td></tr></table></figure></p>
<h3 id="事务语句"><a href="#事务语句" class="headerlink" title="事务语句"></a>事务语句</h3><ul>
<li>开始事物：<code>BEGIN TRANSACTION</code></li>
<li>提交事物：<code>COMMIT TRANSACTION</code></li>
<li>回滚事务：<code>ROLLBACK TRANSACTION</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 开启一个事务</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> db1.<span class="string">`t1`</span>(<span class="keyword">id</span>) <span class="keyword">VALUES</span>(<span class="number">1</span>);</span><br><span class="line"># 提交事务</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"># 开启事务</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> db1.<span class="string">`t1`</span>(<span class="keyword">id</span>) <span class="keyword">VALUES</span>(<span class="number">2</span>);</span><br><span class="line"># 回滚刚才的事务</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>
<h3 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h3><h4 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h4><h4 id="写时复制"><a href="#写时复制" class="headerlink" title="写时复制"></a>写时复制</h4><h4 id="多版本并发控制"><a href="#多版本并发控制" class="headerlink" title="多版本并发控制"></a>多版本并发控制</h4><p>Mysql InnoDB存储引擎,InnoDB对每一行维护了俩个隐含的列,一列用于存储行被修改的时间,另一列存储每一行被删除的时间.</p>
<blockquote>
<p>这里的时间并不是绝对时间,而是与时间对应的数据库系统的版本号,每当一个事务开始时,InnoDB都会给这个事务分配一个递增的版本号,所以版本号也可以被任务是事务好.对于每一行的查询语句,InnoDB都会把这个查询语句的版本号同这个查询雨具遇到的行的版本号进行对比,然后结合不同的事务隔离级别来决定是否返回改行.</p>
</blockquote>
<p>下面以SELECT,DELETE,INSERT,UPDATE为例:</p>
<h5 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h5><p>只有同时满足下面俩个条件的行才能被返回:</p>
<ol>
<li>行的版本号小于等于该事务的版本号</li>
<li>行的删除版本号要么没有定义,要么大于等于事务的版本号<br>如果行的修改或者删除版本号大于事务号,说明行是被该食物后面启动的事务修改或者删除的 </li>
</ol>
<h5 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h5><p>InnoDB直接把该行的删除版本号设置为当前的事务号,相当于标记为删除而不是物理删除</p>
<h5 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h5><p>对于新插入的行,行的修改版本号更新为该事务的事务号</p>
<h5 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h5><p>更新行的时候,InnoDB会把原来的行复制一份,并把当前的事务号作为改行的修改版本号</p>
<h3 id="事务异常"><a href="#事务异常" class="headerlink" title="事务异常"></a>事务异常</h3>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/数据库/">数据库</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/08/数据库/数据库事务/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/08/数据库/数据库事务/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/08/mycat/mycat全局序列号/" title="Mycat全局序列号" itemprop="url">Mycat全局序列号</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2015-10-07T16:00:00.000Z" itemprop="datePublished"> Published 2015-10-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="https://item.taobao.com/item.htm?spm=a230r.1.14.8.eRsdoe&amp;id=44263828402&amp;ns=1&amp;abbucket=17#detail" target="_blank" rel="external">Mycat权威指南V1</a>学习总结</p>
<p>Mycat的全局序列号分为俩部分</p>
<ul>
<li>本地文件方式</li>
<li>数据库方式</li>
</ul>
<p>因为本地文件方式当Mycat重启之后，里面记录的数据会被重置，所以我就只记录一下数据库方式.</p>
<p>在<code>server.xml</code>文件中进行如下配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mycat:server</span> <span class="attr">xmlns:mycat</span>=<span class="string">"http://org.opencloudb/"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">system</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sequnceHandlerType"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:server</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>接下来我们创建一张表,用于存放ID<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> MYCAT_SEQUENCE;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> db1.MYCAT_SEQUENCE</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">  currentValue <span class="built_in">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line">  <span class="keyword">increment</span> <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>(<span class="keyword">name</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="built_in">CHAR</span> <span class="keyword">SET</span>=utf8;</span><br></pre></td></tr></table></figure></p>
<p>获取当前sequence的值<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> mycat_seq_currval;</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_currval(seq_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>)) <span class="keyword">RETURNS</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">CHARSET</span> utf8</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> retval <span class="built_in">VARCHAR</span>(<span class="number">64</span>);</span><br><span class="line">	<span class="keyword">SET</span> retval=<span class="string">"-999999999,null"</span>;</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="keyword">CAST</span>(current_value <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="string">","</span>,<span class="keyword">CAST</span>(<span class="keyword">increment</span> <span class="keyword">AS</span> <span class="built_in">CHAR</span>))</span><br><span class="line">	 <span class="keyword">INTO</span> retval</span><br><span class="line">	 <span class="keyword">FROM</span> MYCAT_SEQUENCE</span><br><span class="line">	 <span class="keyword">WHERE</span> <span class="keyword">NAME</span> = seq_name;</span><br><span class="line">	 RETURN retval;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>这里需要说明一点的是, 由于mysql默认分隔符为<code>;</code>,因此我们要先使用<code>DELIMITER $$</code>将分隔符置为<code>&amp;&amp;</code>,不然的话在函数里也使用到了<code>;</code>会影响到函数,最后再将分隔符置为<code>;</code></p>
</blockquote>
<p>设置sequence值<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> mycat_seq_setval;</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_setval(seq_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>),<span class="keyword">VALUE</span> <span class="built_in">INTEGER</span>) <span class="keyword">RETURNS</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">CHARSET</span> utf8</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">UPDATE</span> MYCAT_SEQUENCE</span><br><span class="line"><span class="keyword">SET</span> current_value = <span class="keyword">VALUE</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NAME</span> = seq_name;</span><br><span class="line">RETURN mycat_seq_currval(seq_name);</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<p>获取下一个sequence值<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> mycat_seq_nextval;</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_nextval(seq_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>)) <span class="keyword">RETURNS</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">CHARSET</span> utf8</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">UPDATE</span> MYCAT_SEQUENCE</span><br><span class="line"><span class="keyword">SET</span> current_value = current_value + <span class="keyword">increment</span> <span class="keyword">WHERE</span> <span class="keyword">NAME</span> = seq_name;</span><br><span class="line">RETURN mycat_seq_currval(seq_name);</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<p>然后修改<code>sequence_db_conf.properties</code>这个配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#sequence stored in datanode</span><br><span class="line">GLOBAL=dn1</span><br><span class="line">COMPANY=dn1</span><br><span class="line">CUSTOMER=dn1</span><br><span class="line">ORDERS=dn1</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>GLOBAL</code></li>
<li><code>COMPANY</code></li>
<li><code>CUSTOMER</code></li>
<li><code>ORDERS</code></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/mycat/">mycat</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/08/mycat/mycat全局序列号/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/08/mycat/mycat全局序列号/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/7/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/9/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="ming15" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Groovy/" title="Groovy">Groovy<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Haskell/" title="Haskell">Haskell<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/JMH/" title="JMH">JMH<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/JVM/" title="JVM">JVM<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaSE/" title="JavaSE">JavaSE<sup>28</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript/" title="JavaScript">JavaScript<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java工具/" title="Java工具">Java工具<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/MongoDB/" title="MongoDB">MongoDB<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Netty/" title="Netty">Netty<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Php/" title="Php">Php<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Reids/" title="Reids">Reids<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/TCP-IP/" title="TCP IP">TCP IP<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/ZooKeeper/" title="ZooKeeper">ZooKeeper<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/asm/" title="asm">asm<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/guice/" title="guice">guice<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/http客户端/" title="http客户端">http客户端<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/http服务器/" title="http服务器">http服务器<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux/" title="linux">linux<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/memcached/" title="memcached">memcached<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/mgits/" title="mgits">mgits<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/mycat/" title="mycat">mycat<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/python2/" title="python2">python2<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/并发编程/" title="并发编程">并发编程<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/序列化工具/" title="序列化工具">序列化工具<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/操作系统/" title="操作系统">操作系统<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库/" title="数据库">数据库<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/日志工具/" title="日志工具">日志工具<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/构建工具/" title="构建工具">构建工具<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  

  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="http://www1.vertx3.cn" target="_blank" title="vertx3">vertx3</a>
            
          </li>
        
    </ul>
</div>

  

<div class="doubanshow">
<p class="asidetitle">Douban Show</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/xxxyy/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=3253370782&verifier=e9ca895b&dpc=1"></iframe>
</div>


  

<div class="lofter">
<p class="asidetitle">Lofter</p>

 <iframe width="100%" height="39" class="share_self"  frameborder="0" scrolling="no" src="http://ming15.lofter.com/"></iframe>
</div>




</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 博客,我选择重构 <br/>
			重构使事情变得更美,更加正确</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/3253370782" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/ming15" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		<a href="https://www.douban.com/people/xxxyy" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/ming15" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="ming15">ming15</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"wanggnim"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F9e8fca440159a2125668804e46682db4' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
